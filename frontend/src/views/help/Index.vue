<template>
  <div class="help-page">
    <n-space vertical :size="24">
      <h1 class="title">å¸®åŠ©ä¸­å¿ƒ</h1>

      <n-card title="å¸¸è§é—®é¢˜" :bordered="false">
        <n-collapse>
          <n-collapse-item title="å¦‚ä½•è´­ä¹°å¥—é¤" name="buy">
            <p>ç™»å½•åå‰å¾€ã€Œè´­ä¹°å¥—é¤ã€é¡µé¢ï¼Œé€‰æ‹©é€‚åˆæ‚¨çš„å¥—é¤å¹¶å®Œæˆæ”¯ä»˜å³å¯ã€‚æ”¯æŒä½™é¢æ”¯ä»˜å’Œåœ¨çº¿æ”¯ä»˜æ–¹å¼ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•ä½¿ç”¨è®¢é˜…é“¾æ¥" name="subscribe">
            <p>è´­ä¹°å¥—é¤åï¼Œå‰å¾€ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢å¤åˆ¶è®¢é˜…é“¾æ¥ï¼Œç„¶åå°†é“¾æ¥å¯¼å…¥åˆ°æ‚¨ä½¿ç”¨çš„å®¢æˆ·ç«¯ä¸­å³å¯ã€‚ä¸åŒå®¢æˆ·ç«¯çš„å¯¼å…¥æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œè¯·å‚è€ƒä¸‹æ–¹å®¢æˆ·ç«¯è¯´æ˜ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="æ”¯æŒå“ªäº›å®¢æˆ·ç«¯" name="clients">
            <p>æˆ‘ä»¬æ”¯æŒä¸»æµçš„ä»£ç†å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ Clash for Windowsã€V2rayNã€Clash Partyã€Hiddifyã€FlClashã€Shadowrocketã€Stash ç­‰ã€‚è¯·å‚è€ƒä¸‹æ–¹å®¢æˆ·ç«¯ä¸‹è½½åŒºåŸŸè·å–å¯¹åº”å¹³å°çš„å®¢æˆ·ç«¯ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•é‡ç½®è®¢é˜…" name="reset">
            <p>å‰å¾€ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œç‚¹å‡»ã€Œé‡ç½®è®¢é˜…é“¾æ¥ã€æŒ‰é’®å³å¯ç”Ÿæˆæ–°çš„è®¢é˜…é“¾æ¥ã€‚é‡ç½®åæ—§é“¾æ¥å°†å¤±æ•ˆï¼Œè¯·åŠæ—¶æ›´æ–°å®¢æˆ·ç«¯ä¸­çš„è®¢é˜…åœ°å€ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="è®¾å¤‡é™åˆ¶è¯´æ˜" name="device">
            <p>æ¯ä¸ªå¥—é¤æœ‰å¯¹åº”çš„è®¾å¤‡æ•°é‡é™åˆ¶ã€‚åŒä¸€è®¢é˜…é“¾æ¥åœ¨ä¸åŒè®¾å¤‡ä¸Šä½¿ç”¨ä¼šå ç”¨è®¾å¤‡åé¢ã€‚å¦‚éœ€é‡Šæ”¾è®¾å¤‡åé¢ï¼Œè¯·å‰å¾€ã€Œè®¾å¤‡ç®¡ç†ã€é¡µé¢åˆ é™¤ä¸å†ä½¿ç”¨çš„è®¾å¤‡ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•è”ç³»å®¢æœ" name="contact">
            <p>æ‚¨å¯ä»¥é€šè¿‡æäº¤å·¥å•çš„æ–¹å¼è”ç³»å®¢æœï¼Œå‰å¾€ã€Œå·¥å•ã€é¡µé¢åˆ›å»ºæ–°å·¥å•å³å¯ã€‚æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨çš„é—®é¢˜ã€‚</p>
          </n-collapse-item>
        </n-collapse>
      </n-card>

      <n-card title="ä½¿ç”¨æ•™ç¨‹" :bordered="false">
        <!-- Desktop: segment tabs -->
        <n-tabs v-if="!appStore.isMobile" type="segment" size="small" animated>
          <n-tab-pane v-for="t in tutorials" :key="t.key" :name="t.key" :tab="t.tab">
            <div class="tutorial">
              <h4>{{ t.title }}</h4>
              <p v-if="t.note" class="tut-note">{{ t.note }}</p>
              <template v-for="(section, si) in t.sections" :key="si">
                <h5 v-if="section.subtitle">{{ section.subtitle }}</h5>
                <ol><li v-for="(step, i) in section.steps" :key="i" v-html="step" /></ol>
              </template>
              <p v-if="t.tip" class="tut-tip" v-html="t.tip" />
            </div>
          </n-tab-pane>
        </n-tabs>

        <!-- Mobile: card list with collapse -->
        <div v-else class="tut-card-list">
          <div v-for="t in tutorials" :key="t.key" class="tut-card" @click="toggleTut(t.key)">
            <div class="tut-card-header">
              <span class="tut-card-icon">{{ t.icon }}</span>
              <div class="tut-card-meta">
                <span class="tut-card-name">{{ t.tab }}</span>
                <span class="tut-card-platform">{{ t.platform }}</span>
              </div>
              <n-icon :component="expandedTut === t.key ? ChevronUpOutline : ChevronDownOutline" size="18" color="#999" />
            </div>
            <div v-if="expandedTut === t.key" class="tut-card-body" @click.stop>
              <p v-if="t.note" class="tut-note">{{ t.note }}</p>
              <template v-for="(section, si) in t.sections" :key="si">
                <div v-if="section.subtitle" class="tut-subtitle">{{ section.subtitle }}</div>
                <ol><li v-for="(step, i) in section.steps" :key="i" v-html="step" /></ol>
              </template>
              <p v-if="t.tip" class="tut-tip" v-html="t.tip" />
            </div>
          </div>
        </div>
      </n-card>

      <n-card title="è½¯ä»¶ä¸‹è½½" :bordered="false">
        <n-spin :show="loadingConfig">
          <div v-if="hasAnyClient">
            <n-tabs type="segment" size="small" animated>
              <n-tab-pane name="windows" tab="Windows" v-if="windowsClients.length">
                <div class="client-grid">
                  <a v-for="c in windowsClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="android" tab="Android" v-if="androidClients.length">
                <div class="client-grid">
                  <a v-for="c in androidClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="macos" tab="macOS" v-if="macClients.length">
                <div class="client-grid">
                  <a v-for="c in macClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="ios" tab="iOS" v-if="iosClients.length">
                <div class="client-grid">
                  <a v-for="c in iosClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="linux" tab="Linux" v-if="linuxClients.length">
                <div class="client-grid">
                  <a v-for="c in linuxClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
            </n-tabs>
          </div>
          <n-empty v-else-if="!loadingConfig" description="ç®¡ç†å‘˜æš‚æœªé…ç½®ä¸‹è½½é“¾æ¥" />
        </n-spin>
      </n-card>

      <n-card title="è”ç³»æˆ‘ä»¬" :bordered="false">
        <n-space vertical :size="8">
          <n-text>å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š</n-text>
          <n-text>1. æäº¤å·¥å•ï¼šå‰å¾€ã€Œå·¥å•ã€é¡µé¢åˆ›å»ºæ–°å·¥å•</n-text>
          <n-text>2. é‚®ä»¶è”ç³»ï¼šå‘é€é‚®ä»¶è‡³å®¢æœé‚®ç®±</n-text>
          <n-text depth="3">å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00 - 18:00ï¼Œå·¥å•é€šå¸¸åœ¨ 24 å°æ—¶å†…å›å¤ã€‚</n-text>
        </n-space>
      </n-card>
    </n-space>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { DownloadOutline, ChevronDownOutline, ChevronUpOutline } from '@vicons/ionicons5'
import { getPublicConfig } from '@/api/common'
import { useAppStore } from '@/stores/app'

const appStore = useAppStore()
const loadingConfig = ref(false)
const config = ref<Record<string, string>>({})
const expandedTut = ref('')

const toggleTut = (key: string) => {
  expandedTut.value = expandedTut.value === key ? '' : key
}

interface TutSection { subtitle?: string; steps: string[] }
interface Tutorial {
  key: string; tab: string; icon: string; platform: string; title: string;
  note?: string; tip?: string; sections: TutSection[]
}

const tutorials: Tutorial[] = [
  {
    key: 'shadowrocket', tab: 'Shadowrocket', icon: 'ğŸš€', platform: 'iOS',
    title: 'Shadowrocket ä½¿ç”¨æ•™ç¨‹',
    note: 'Shadowrocket éœ€è¦ä½¿ç”¨éä¸­å›½å¤§é™† Apple ID åœ¨ App Store è´­ä¹°ä¸‹è½½ï¼ˆå”®ä»·çº¦ $2.99ï¼‰ã€‚',
    sections: [{ steps: [
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶<strong>é€šç”¨è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ Shadowrocketï¼Œç‚¹å‡»å³ä¸Šè§’ <strong>+</strong> æŒ‰é’®ã€‚',
      'ç±»å‹é€‰æ‹© <strong>Subscribe</strong>ï¼ˆè®¢é˜…ï¼‰ã€‚',
      'åœ¨ URL æ ç²˜è´´åˆšæ‰å¤åˆ¶çš„è®¢é˜…é“¾æ¥ï¼Œå¤‡æ³¨å¯å¡«å†™ä»»æ„åç§°ã€‚',
      'ç‚¹å‡»å³ä¸Šè§’<strong>å®Œæˆ</strong>ä¿å­˜ã€‚',
      'å›åˆ°é¦–é¡µï¼Œç‚¹å‡»è®¢é˜…å³ä¾§çš„åˆ·æ–°æŒ‰é’®æ›´æ–°èŠ‚ç‚¹åˆ—è¡¨ã€‚',
      'é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰“å¼€é¡¶éƒ¨çš„<strong>è¿æ¥å¼€å…³</strong>å³å¯ä½¿ç”¨ã€‚',
    ] }],
    tip: 'æç¤ºï¼šä¹Ÿå¯ä»¥ç›´æ¥åœ¨ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ç‚¹å‡» Shadowrocket äºŒç»´ç ï¼Œç”¨ Shadowrocket æ‰«ç ä¸€é”®å¯¼å…¥ã€‚',
  },
  {
    key: 'clash', tab: 'Clash', icon: 'ğŸ”µ', platform: 'Windows',
    title: 'Clash for Windows ä½¿ç”¨æ•™ç¨‹',
    sections: [{ steps: [
      'ä¸‹è½½å¹¶å®‰è£… Clash for Windowsï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶ <strong>Clash è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ Clash for Windowsï¼Œç‚¹å‡»å·¦ä¾§ <strong>Profiles</strong>ï¼ˆé…ç½®ï¼‰ã€‚',
      'åœ¨é¡¶éƒ¨è¾“å…¥æ¡†ç²˜è´´ Clash è®¢é˜…é“¾æ¥ï¼Œç‚¹å‡» <strong>Download</strong>ã€‚',
      'ä¸‹è½½å®Œæˆåï¼Œç‚¹å‡»è¯¥é…ç½®æ–‡ä»¶ä½¿å…¶é«˜äº®é€‰ä¸­ã€‚',
      'åˆ‡æ¢åˆ° <strong>Proxies</strong>ï¼ˆä»£ç†ï¼‰é¡µé¢ï¼Œé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚',
      'åˆ‡æ¢åˆ° <strong>General</strong>ï¼ˆå¸¸è§„ï¼‰é¡µé¢ï¼Œæ‰“å¼€ <strong>System Proxy</strong>ï¼ˆç³»ç»Ÿä»£ç†ï¼‰ã€‚',
    ] }],
    tip: 'æç¤ºï¼šå»ºè®®å¼€å¯ Clash çš„ã€Œå¼€æœºè‡ªå¯ã€åŠŸèƒ½ï¼Œé¿å…æ¯æ¬¡æ‰‹åŠ¨å¯åŠ¨ã€‚',
  },
  {
    key: 'v2rayn', tab: 'V2rayN', icon: 'ğŸŸ¢', platform: 'Windows',
    title: 'V2rayN ä½¿ç”¨æ•™ç¨‹',
    sections: [{ steps: [
      'ä¸‹è½½å¹¶è§£å‹ V2rayNï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶<strong>é€šç”¨è®¢é˜…é“¾æ¥</strong>ã€‚',
      'è¿è¡Œ V2rayNï¼Œå³é”®ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ â†’ <strong>è®¢é˜…åˆ†ç»„è®¾ç½®</strong>ã€‚',
      'ç‚¹å‡»<strong>æ·»åŠ </strong>ï¼Œåœ¨åœ°å€æ ç²˜è´´è®¢é˜…é“¾æ¥ï¼Œå¤‡æ³¨å¡«å†™ä»»æ„åç§°ï¼Œç‚¹å‡»ç¡®å®šã€‚',
      'å³é”®æ‰˜ç›˜å›¾æ ‡ â†’ <strong>æ›´æ–°è®¢é˜…</strong>ï¼ˆä¸é€šè¿‡ä»£ç†ï¼‰ã€‚',
      'åœ¨ä¸»ç•Œé¢é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå³é”® â†’ <strong>è®¾ä¸ºæ´»åŠ¨æœåŠ¡å™¨</strong>ã€‚',
      'å³é”®æ‰˜ç›˜å›¾æ ‡ â†’ ç³»ç»Ÿä»£ç† â†’ <strong>è‡ªåŠ¨é…ç½®ç³»ç»Ÿä»£ç†</strong>ã€‚',
    ] }],
  },
  {
    key: 'android', tab: 'Android', icon: 'ğŸ¤–', platform: 'Android',
    title: 'V2rayNG / Clash Meta ä½¿ç”¨æ•™ç¨‹',
    sections: [
      { subtitle: 'V2rayNG', steps: [
        'ä¸‹è½½å¹¶å®‰è£… V2rayNGï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
        'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶<strong>é€šç”¨è®¢é˜…é“¾æ¥</strong>ã€‚',
        'æ‰“å¼€ V2rayNGï¼Œç‚¹å‡»å·¦ä¸Šè§’èœå• â†’ <strong>è®¢é˜…åˆ†ç»„è®¾ç½®</strong>ã€‚',
        'ç‚¹å‡»å³ä¸Šè§’ <strong>+</strong>ï¼Œåœ¨åœ°å€æ ç²˜è´´è®¢é˜…é“¾æ¥ï¼Œç‚¹å‡»å³ä¸Šè§’ âœ“ ä¿å­˜ã€‚',
        'è¿”å›ä¸»ç•Œé¢ï¼Œç‚¹å‡»å³ä¸Šè§’èœå• â†’ <strong>æ›´æ–°è®¢é˜…</strong>ã€‚',
        'é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç‚¹å‡»å³ä¸‹è§’ <strong>V</strong> æŒ‰é’®è¿æ¥ã€‚',
      ] },
      { subtitle: 'Clash Meta for Android', steps: [
        'ä¸‹è½½å¹¶å®‰è£… Clash Metaï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
        'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶ <strong>Clash è®¢é˜…é“¾æ¥</strong>ã€‚',
        'æ‰“å¼€ Clash Metaï¼Œç‚¹å‡» <strong>Profile</strong>ï¼ˆé…ç½®ï¼‰ã€‚',
        'ç‚¹å‡»å³ä¸Šè§’ <strong>+</strong> â†’ <strong>URL</strong>ï¼Œç²˜è´´ Clash è®¢é˜…é“¾æ¥ï¼Œç‚¹å‡»ä¿å­˜ã€‚',
        'é€‰ä¸­è¯¥é…ç½®ï¼Œè¿”å›ä¸»é¡µç‚¹å‡»<strong>å¯åŠ¨</strong>æŒ‰é’®ã€‚',
      ] },
    ],
  },
  {
    key: 'stash', tab: 'Stash', icon: 'ğŸŸ¡', platform: 'iOS',
    title: 'Stash ä½¿ç”¨æ•™ç¨‹',
    note: 'Stash éœ€è¦ä½¿ç”¨éä¸­å›½å¤§é™† Apple ID åœ¨ App Store è´­ä¹°ä¸‹è½½ã€‚',
    sections: [{ steps: [
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶ <strong>Clash è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ Stashï¼Œè¿›å…¥<strong>è®¾ç½®</strong> â†’ <strong>é…ç½®</strong> â†’ <strong>ä» URL ä¸‹è½½</strong>ã€‚',
      'ç²˜è´´ Clash è®¢é˜…é“¾æ¥ï¼Œç‚¹å‡»<strong>ä¸‹è½½</strong>ã€‚',
      'ä¸‹è½½å®Œæˆåé€‰ä¸­è¯¥é…ç½®æ–‡ä»¶ã€‚',
      'è¿”å›é¦–é¡µï¼Œé€‰æ‹©èŠ‚ç‚¹å¹¶æ‰“å¼€è¿æ¥å¼€å…³ã€‚',
    ] }],
  },
  {
    key: 'clashparty', tab: 'Clash Party', icon: 'ğŸŸ£', platform: 'Win / macOS',
    title: 'Clash Party ä½¿ç”¨æ•™ç¨‹',
    sections: [{ steps: [
      'ä¸‹è½½å¹¶å®‰è£… Clash Partyï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶ <strong>Clash è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ Clash Partyï¼Œè¿›å…¥<strong>è®¢é˜…ç®¡ç†</strong>ã€‚',
      'ç‚¹å‡»<strong>å¯¼å…¥</strong>ï¼Œç²˜è´´ Clash è®¢é˜…é“¾æ¥ï¼Œç¡®è®¤å¯¼å…¥ã€‚',
      'é€‰ä¸­å¯¼å…¥çš„é…ç½®ï¼Œè¿”å›ä¸»é¡µã€‚',
      'é€‰æ‹©èŠ‚ç‚¹ï¼Œå¼€å¯<strong>ç³»ç»Ÿä»£ç†</strong>å³å¯ä½¿ç”¨ã€‚',
    ] }],
  },
  {
    key: 'flclash', tab: 'FlClash', icon: 'âš¡', platform: 'å…¨å¹³å°',
    title: 'FlClash ä½¿ç”¨æ•™ç¨‹',
    sections: [{ steps: [
      'ä¸‹è½½å¹¶å®‰è£… FlClashï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶ <strong>Clash è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ FlClashï¼Œè¿›å…¥<strong>é…ç½®</strong>é¡µé¢ã€‚',
      'ç‚¹å‡» <strong>+</strong> æ·»åŠ é…ç½® â†’ é€‰æ‹© <strong>URL å¯¼å…¥</strong>ã€‚',
      'ç²˜è´´ Clash è®¢é˜…é“¾æ¥ï¼Œç‚¹å‡»ç¡®è®¤ã€‚',
      'é€‰ä¸­é…ç½®åï¼Œåœ¨<strong>ä»£ç†</strong>é¡µé¢é€‰æ‹©èŠ‚ç‚¹ã€‚',
      'å¼€å¯<strong>ç³»ç»Ÿä»£ç†</strong>æˆ– <strong>TUN æ¨¡å¼</strong>å³å¯ä½¿ç”¨ã€‚',
    ] }],
  },
  {
    key: 'hiddify', tab: 'Hiddify', icon: 'ğŸŸ ', platform: 'Win / Android',
    title: 'Hiddify ä½¿ç”¨æ•™ç¨‹',
    sections: [{ steps: [
      'ä¸‹è½½å¹¶å®‰è£… Hiddifyï¼ˆè§ä¸‹æ–¹ä¸‹è½½åŒºåŸŸï¼‰ã€‚',
      'æ‰“å¼€æœ¬ç«™ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œå¤åˆ¶<strong>é€šç”¨è®¢é˜…é“¾æ¥</strong>ã€‚',
      'æ‰“å¼€ Hiddifyï¼Œç‚¹å‡» <strong>+</strong> æ·»åŠ é…ç½®ã€‚',
      'é€‰æ‹©<strong>ä»é“¾æ¥æ·»åŠ </strong>ï¼Œç²˜è´´è®¢é˜…é“¾æ¥ã€‚',
      'ç­‰å¾…èŠ‚ç‚¹åŠ è½½å®Œæˆï¼Œé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚',
      'ç‚¹å‡»åº•éƒ¨çš„<strong>è¿æ¥</strong>æŒ‰é’®å³å¯ä½¿ç”¨ã€‚',
    ] }],
  },
]

const allClients = {
  windows: [
    { key: 'client_clash_windows_url', name: 'Clash for Windows', icon: 'ğŸ”µ', desc: 'Clash å†…æ ¸ï¼Œæ”¯æŒå¤šç§åè®®' },
    { key: 'client_v2rayn_url', name: 'V2rayN', icon: 'ğŸŸ¢', desc: 'V2Ray å›¾å½¢åŒ–å®¢æˆ·ç«¯' },
    { key: 'client_clashparty_windows_url', name: 'Clash Party', icon: 'ğŸŸ£', desc: 'Clash Party GUI å®¢æˆ·ç«¯' },
    { key: 'client_hiddify_windows_url', name: 'Hiddify', icon: 'ğŸŸ ', desc: 'å¤šåè®®ä»£ç†å®¢æˆ·ç«¯' },
    { key: 'client_flclash_windows_url', name: 'FlClash', icon: 'âš¡', desc: 'Flutter è·¨å¹³å° Clash å®¢æˆ·ç«¯' },
  ],
  android: [
    { key: 'client_clash_android_url', name: 'Clash Meta', icon: 'ğŸ”µ', desc: 'Android Clash å®¢æˆ·ç«¯' },
    { key: 'client_v2rayng_url', name: 'V2rayNG', icon: 'ğŸŸ¢', desc: 'Android V2Ray å®¢æˆ·ç«¯' },
    { key: 'client_hiddify_android_url', name: 'Hiddify', icon: 'ğŸŸ ', desc: 'Android å¤šåè®®å®¢æˆ·ç«¯' },
  ],
  macos: [
    { key: 'client_flclash_macos_url', name: 'FlClash', icon: 'âš¡', desc: 'macOS Clash å®¢æˆ·ç«¯' },
    { key: 'client_clashparty_macos_url', name: 'Clash Party', icon: 'ğŸŸ£', desc: 'macOS Clash Party å®¢æˆ·ç«¯' },
  ],
  ios: [
    { key: 'client_shadowrocket_url', name: 'Shadowrocket', icon: 'ğŸš€', desc: 'éœ€å¤–åŒº Apple ID è´­ä¹°' },
    { key: 'client_stash_url', name: 'Stash', icon: 'ğŸŸ¡', desc: 'åŸºäºè§„åˆ™çš„ä»£ç†å®¢æˆ·ç«¯' },
  ],
  linux: [
    { key: 'client_clash_linux_url', name: 'Clash', icon: 'ğŸ§', desc: 'Linux Clash å®¢æˆ·ç«¯' },
    { key: 'client_singbox_url', name: 'Sing-box', icon: 'ğŸ“¦', desc: 'é€šç”¨ä»£ç†å¹³å°' },
  ],
}

const filterClients = (list: typeof allClients.windows) =>
  list.filter(c => config.value[c.key]).map(c => ({ ...c, url: config.value[c.key] }))

const windowsClients = computed(() => filterClients(allClients.windows))
const androidClients = computed(() => filterClients(allClients.android))
const macClients = computed(() => filterClients(allClients.macos))
const iosClients = computed(() => filterClients(allClients.ios))
const linuxClients = computed(() => filterClients(allClients.linux))
const hasAnyClient = computed(() =>
  Object.values(allClients).flat().some(c => config.value[c.key])
)

onMounted(async () => {
  loadingConfig.value = true
  try {
    const res: any = await getPublicConfig()
    if (res.data) config.value = res.data
  } catch {}
  finally { loadingConfig.value = false }
})
</script>

<style scoped>
.help-page {
  padding: 24px;
}

.title {
  font-size: 28px;
  font-weight: 600;
  margin: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.client-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px 0;
}

.client-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  border-radius: 10px;
  background: rgba(0,0,0,0.03);
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  color: inherit;
}
.client-card:hover {
  background: rgba(0,0,0,0.04);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.client-icon { font-size: 24px; flex-shrink: 0; }
.client-info { flex: 1; display: flex; flex-direction: column; gap: 2px; }
.client-name { font-size: 15px; font-weight: 600; }
.client-desc { font-size: 12px; color: #999; }

.tutorial { padding: 12px 0; }
.tutorial h4 { margin: 0 0 12px; font-size: 16px; font-weight: 600; }
.tutorial h5 { margin: 16px 0 8px; font-size: 14px; font-weight: 600; color: #555; }
.tutorial ol { padding-left: 20px; margin: 0; }
.tutorial li { margin: 6px 0; font-size: 14px; line-height: 1.7; color: #444; }
.tutorial li strong { color: #333; }
.tut-note { background: #fff7e6; border: 1px solid #ffe58f; border-radius: 6px; padding: 8px 12px; font-size: 13px; color: #ad6800; margin-bottom: 12px; }
.tut-tip { background: #f6ffed; border: 1px solid #b7eb8f; border-radius: 6px; padding: 8px 12px; font-size: 13px; color: #389e0d; margin-top: 12px; }

@media (max-width: 767px) {
  .help-page { padding: 0; }
  .client-card { padding: 12px 14px; }
}

/* Mobile tutorial cards */
.tut-card-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.tut-card {
  border-radius: 10px;
  background: rgba(0,0,0,0.025);
  overflow: hidden;
  cursor: pointer;
  transition: background 0.2s;
}

.tut-card-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;
}

.tut-card-icon {
  font-size: 22px;
  flex-shrink: 0;
}

.tut-card-meta {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.tut-card-name {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-color, #333);
}

.tut-card-platform {
  font-size: 11px;
  color: #999;
}

.tut-card-body {
  padding: 0 14px 14px;
  cursor: default;
}

.tut-card-body ol {
  padding-left: 18px;
  margin: 0;
}

.tut-card-body li {
  margin: 4px 0;
  font-size: 13px;
  line-height: 1.6;
  color: #555;
}

.tut-subtitle {
  font-size: 13px;
  font-weight: 600;
  color: #555;
  margin: 10px 0 4px;
}

.tut-card-body .tut-note,
.tut-card-body .tut-tip {
  font-size: 12px;
  padding: 6px 10px;
}
</style>