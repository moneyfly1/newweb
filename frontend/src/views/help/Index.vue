<template>
  <div class="help-page">
    <n-space vertical :size="24">
      <h1 class="title">å¸®åŠ©ä¸­å¿ƒ</h1>

      <n-card title="å¸¸è§é—®é¢˜" :bordered="false">
        <n-collapse>
          <n-collapse-item title="å¦‚ä½•è´­ä¹°å¥—é¤" name="buy">
            <p>ç™»å½•åå‰å¾€ã€Œè´­ä¹°å¥—é¤ã€é¡µé¢ï¼Œé€‰æ‹©é€‚åˆæ‚¨çš„å¥—é¤å¹¶å®Œæˆæ”¯ä»˜å³å¯ã€‚æ”¯æŒä½™é¢æ”¯ä»˜å’Œåœ¨çº¿æ”¯ä»˜æ–¹å¼ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•ä½¿ç”¨è®¢é˜…é“¾æ¥" name="subscribe">
            <p>è´­ä¹°å¥—é¤åï¼Œå‰å¾€ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢å¤åˆ¶è®¢é˜…é“¾æ¥ï¼Œç„¶åå°†é“¾æ¥å¯¼å…¥åˆ°æ‚¨ä½¿ç”¨çš„å®¢æˆ·ç«¯ä¸­å³å¯ã€‚ä¸åŒå®¢æˆ·ç«¯çš„å¯¼å…¥æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œè¯·å‚è€ƒä¸‹æ–¹å®¢æˆ·ç«¯è¯´æ˜ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="æ”¯æŒå“ªäº›å®¢æˆ·ç«¯" name="clients">
            <p>æˆ‘ä»¬æ”¯æŒä¸»æµçš„ä»£ç†å®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ Clash for Windowsã€V2rayNã€Mihomo Partyã€Hiddifyã€FlClashã€Shadowrocketã€Stash ç­‰ã€‚è¯·å‚è€ƒä¸‹æ–¹å®¢æˆ·ç«¯ä¸‹è½½åŒºåŸŸè·å–å¯¹åº”å¹³å°çš„å®¢æˆ·ç«¯ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•é‡ç½®è®¢é˜…" name="reset">
            <p>å‰å¾€ã€Œæˆ‘çš„è®¢é˜…ã€é¡µé¢ï¼Œç‚¹å‡»ã€Œé‡ç½®è®¢é˜…é“¾æ¥ã€æŒ‰é’®å³å¯ç”Ÿæˆæ–°çš„è®¢é˜…é“¾æ¥ã€‚é‡ç½®åæ—§é“¾æ¥å°†å¤±æ•ˆï¼Œè¯·åŠæ—¶æ›´æ–°å®¢æˆ·ç«¯ä¸­çš„è®¢é˜…åœ°å€ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="è®¾å¤‡é™åˆ¶è¯´æ˜" name="device">
            <p>æ¯ä¸ªå¥—é¤æœ‰å¯¹åº”çš„è®¾å¤‡æ•°é‡é™åˆ¶ã€‚åŒä¸€è®¢é˜…é“¾æ¥åœ¨ä¸åŒè®¾å¤‡ä¸Šä½¿ç”¨ä¼šå ç”¨è®¾å¤‡åé¢ã€‚å¦‚éœ€é‡Šæ”¾è®¾å¤‡åé¢ï¼Œè¯·å‰å¾€ã€Œè®¾å¤‡ç®¡ç†ã€é¡µé¢åˆ é™¤ä¸å†ä½¿ç”¨çš„è®¾å¤‡ã€‚</p>
          </n-collapse-item>
          <n-collapse-item title="å¦‚ä½•è”ç³»å®¢æœ" name="contact">
            <p>æ‚¨å¯ä»¥é€šè¿‡æäº¤å·¥å•çš„æ–¹å¼è”ç³»å®¢æœï¼Œå‰å¾€ã€Œå·¥å•ã€é¡µé¢åˆ›å»ºæ–°å·¥å•å³å¯ã€‚æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨çš„é—®é¢˜ã€‚</p>
          </n-collapse-item>
        </n-collapse>
      </n-card>

      <n-card title="è½¯ä»¶ä¸‹è½½" :bordered="false">
        <n-spin :show="loadingConfig">
          <div v-if="hasAnyClient">
            <n-tabs type="segment" size="small" animated>
              <n-tab-pane name="windows" tab="Windows" v-if="windowsClients.length">
                <div class="client-grid">
                  <a v-for="c in windowsClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="android" tab="Android" v-if="androidClients.length">
                <div class="client-grid">
                  <a v-for="c in androidClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="macos" tab="macOS" v-if="macClients.length">
                <div class="client-grid">
                  <a v-for="c in macClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="ios" tab="iOS" v-if="iosClients.length">
                <div class="client-grid">
                  <a v-for="c in iosClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
              <n-tab-pane name="linux" tab="Linux" v-if="linuxClients.length">
                <div class="client-grid">
                  <a v-for="c in linuxClients" :key="c.key" class="client-card" :href="c.url" target="_blank" rel="noopener">
                    <span class="client-icon">{{ c.icon }}</span>
                    <div class="client-info">
                      <span class="client-name">{{ c.name }}</span>
                      <span class="client-desc">{{ c.desc }}</span>
                    </div>
                    <n-icon :component="DownloadOutline" size="18" color="#667eea" />
                  </a>
                </div>
              </n-tab-pane>
            </n-tabs>
          </div>
          <n-empty v-else-if="!loadingConfig" description="ç®¡ç†å‘˜æš‚æœªé…ç½®ä¸‹è½½é“¾æ¥" />
        </n-spin>
      </n-card>

      <n-card title="è”ç³»æˆ‘ä»¬" :bordered="false">
        <n-space vertical :size="8">
          <n-text>å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»æˆ‘ä»¬ï¼š</n-text>
          <n-text>1. æäº¤å·¥å•ï¼šå‰å¾€ã€Œå·¥å•ã€é¡µé¢åˆ›å»ºæ–°å·¥å•</n-text>
          <n-text>2. é‚®ä»¶è”ç³»ï¼šå‘é€é‚®ä»¶è‡³å®¢æœé‚®ç®±</n-text>
          <n-text depth="3">å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00 - 18:00ï¼Œå·¥å•é€šå¸¸åœ¨ 24 å°æ—¶å†…å›å¤ã€‚</n-text>
        </n-space>
      </n-card>
    </n-space>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { DownloadOutline } from '@vicons/ionicons5'
import { getPublicConfig } from '@/api/common'

const loadingConfig = ref(false)
const config = ref<Record<string, string>>({})

const allClients = {
  windows: [
    { key: 'client_clash_windows_url', name: 'Clash for Windows', icon: 'ğŸ”µ', desc: 'Clash å†…æ ¸ï¼Œæ”¯æŒå¤šç§åè®®' },
    { key: 'client_v2rayn_url', name: 'V2rayN', icon: 'ğŸŸ¢', desc: 'V2Ray å›¾å½¢åŒ–å®¢æˆ·ç«¯' },
    { key: 'client_mihomo_windows_url', name: 'Mihomo Party', icon: 'ğŸŸ£', desc: 'Mihomo å†…æ ¸ GUI å®¢æˆ·ç«¯' },
    { key: 'client_hiddify_windows_url', name: 'Hiddify', icon: 'ğŸŸ ', desc: 'å¤šåè®®ä»£ç†å®¢æˆ·ç«¯' },
    { key: 'client_flclash_windows_url', name: 'FlClash', icon: 'âš¡', desc: 'Flutter è·¨å¹³å° Clash å®¢æˆ·ç«¯' },
  ],
  android: [
    { key: 'client_clash_android_url', name: 'Clash Meta', icon: 'ğŸ”µ', desc: 'Android Clash å®¢æˆ·ç«¯' },
    { key: 'client_v2rayng_url', name: 'V2rayNG', icon: 'ğŸŸ¢', desc: 'Android V2Ray å®¢æˆ·ç«¯' },
    { key: 'client_hiddify_android_url', name: 'Hiddify', icon: 'ğŸŸ ', desc: 'Android å¤šåè®®å®¢æˆ·ç«¯' },
  ],
  macos: [
    { key: 'client_flclash_macos_url', name: 'FlClash', icon: 'âš¡', desc: 'macOS Clash å®¢æˆ·ç«¯' },
    { key: 'client_mihomo_macos_url', name: 'Mihomo Party', icon: 'ğŸŸ£', desc: 'macOS Mihomo å®¢æˆ·ç«¯' },
  ],
  ios: [
    { key: 'client_shadowrocket_url', name: 'Shadowrocket', icon: 'ğŸš€', desc: 'éœ€å¤–åŒº Apple ID è´­ä¹°' },
    { key: 'client_stash_url', name: 'Stash', icon: 'ğŸŸ¡', desc: 'åŸºäºè§„åˆ™çš„ä»£ç†å®¢æˆ·ç«¯' },
  ],
  linux: [
    { key: 'client_clash_linux_url', name: 'Clash', icon: 'ğŸ§', desc: 'Linux Clash å®¢æˆ·ç«¯' },
    { key: 'client_singbox_url', name: 'Sing-box', icon: 'ğŸ“¦', desc: 'é€šç”¨ä»£ç†å¹³å°' },
  ],
}

const filterClients = (list: typeof allClients.windows) =>
  list.filter(c => config.value[c.key]).map(c => ({ ...c, url: config.value[c.key] }))

const windowsClients = computed(() => filterClients(allClients.windows))
const androidClients = computed(() => filterClients(allClients.android))
const macClients = computed(() => filterClients(allClients.macos))
const iosClients = computed(() => filterClients(allClients.ios))
const linuxClients = computed(() => filterClients(allClients.linux))
const hasAnyClient = computed(() =>
  Object.values(allClients).flat().some(c => config.value[c.key])
)

onMounted(async () => {
  loadingConfig.value = true
  try {
    const res: any = await getPublicConfig()
    if (res.data) config.value = res.data
  } catch {}
  finally { loadingConfig.value = false }
})
</script>

<style scoped>
.help-page {
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.title {
  font-size: 28px;
  font-weight: 600;
  margin: 0;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.client-grid {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px 0;
}

.client-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  border-radius: 10px;
  background: var(--n-color-embedded, #f5f5f5);
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  color: inherit;
}
.client-card:hover {
  background: var(--n-color-hover, #eee);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
}

.client-icon { font-size: 24px; flex-shrink: 0; }
.client-info { flex: 1; display: flex; flex-direction: column; gap: 2px; }
.client-name { font-size: 15px; font-weight: 600; }
.client-desc { font-size: 12px; color: #999; }

@media (max-width: 767px) {
  .help-page { padding: 0; }
  .client-card { padding: 12px 14px; }
}
</style>